# Bundler

* 왜 번들러를 사용하는가?

사실 몇 십년 전만 해도 하나의 파일을 읽는 중에 또 다른 파일에 접근하는 것은 시간이 많이 걸리는 일이었기에 가능하다면 피하는 것이 좋은 일이었습니다. 하지만 지금은 파일을 몇 개를 나누던 거의 차이가 없을 정도로 컴퓨터 성능이 좋아졌습니다.

그래서 웹 어플리케이션에서 가장 느린 부분은 일반적으로 HTTP Request입니다. 파일을 아무리 많이 나누어도 거의 차이가 없는 머신 내에서의 처리와 달리 웹 상에서의 처리는 요청과 응답으로 이루어져 있기 때문에 시간적인 갭이 클 수 있습니다. 만약 요청을 하고 응답을 받는데 이 서버가 미국에 있는 등의 환경에 의해서 2초가 걸린다고 가정을 해보겠습니다. 만약 파일 1개인 프로젝트라면 요청하는데 2초가 걸릴 것이고 5개인 프로젝트는 10초가 걸릴 수 있습니다. 만약 꽤 큰 프로젝트여서 50개 정도의 파일로 이루어졌다면  모든 요청이 끝나는데 100초가 걸릴 수 있습니다.

웹 환경에서는 머신의 성능과 관계 없이 인터넷 속도나 거리 등에 의해서 영향을 받을 수 있는 것입니다. 그러니 가능하면 파일을 나누어서 요청을 받기 보다는 하나로 합쳐서 보내는 것이 현명할 것입니다.

분명 컴퓨터에게는 하나의 파일이든 여러 개의 파일이든 차이 없이 인식을 할 것입니다. 하지만 개발자 입장에서 5000줄 정도의 파일을 작성하고 관리를 해야 한다면 그건 저주와 같을 수 있습니다. 극악의 가독성을 자랑할 것이고 유지 보수는 점점 더 어려워 질 것입니다. 만약 이런 프로젝트를 인수인계 받아야 된다고 가정해 보는 것만으로도 끔찍하네요. 그러니 HTML파일, CSS파일, JS파일 등을 깔끔하게 분리하고 가독성을 위해서 추가로 나누는 것은 꼭 필요합니다. 그렇다면 UX와 퍼포먼스는 포기해야 하는 것일까요?

이런 고민을 해결해 줄 수 있는 것이 번들러입니다. 번들러는 지정한 단위로 파일들을 하나로 만들어서 요청에 대한 응답으로 전달할 수 있은 환경을 만들어주는 역할을 합니다. (어떤 면에서는 컴파일러와 닮아 있기도 하지만 이렇게 합쳐진 파일이 실행되는 것은 여전히 스크립트 방식일 것입니다. )

* nodejs 에서의 번들러 사용

webpack을 설치하기 위해서는 Node.js와 npm을 먼저 설치해야 합니다.
(Node.js는 비동기 주도 JavaScript 런타임으로써 Node는 확장성 있는 네트워크 어플리케이션(주로 서버쪽)을 만들 수 있도록 설계되었습니다.  npm은 Node Packaged Modules의 약자로 Node.js에서 사용되는 모듈을 패키지로 모아놓은 곳입니다.)

우선 Node.js를 다운로드 받아서 디폴트 설정으로 설치를 합니다. 이 때 이미 내부에 npm도 같이 설치가 되므로 따로 설지할 필요는 없습니다.  npm을 사용하기 위해서는 terminal에서  다음을 입력합니다. (window 사용자의 경우 cmd창에서 하거나 git bash를 이용하거나 webstorm 편집기의 terminal을 사용하면 됩니다. 나머지의 경우 terminal에서 사용할 수 있습니다.)


그럼 package.json이 생성되고 여기에 프로젝트에 관한 정보들을 적어 넣을 수 있습니다. package.json 파일에서 특히 중요한 부분이 "scripts":{} 부분인데 여기에 파일들이 어떻게 합칠지를 정의합니다.

  "scripts": {
      "bundle": "npm run bundle-main && npm run bundle-worker",
      "bundle-main": "webpack js/main/test1.js dist/main-bundle.js",
      "bundle-worker": "webpack js/worker/test2.js dist/worker-bundle.js"
    },

위 코드에서는 번들러가 폴더의 파일을 합쳐서 하나의 파일로 만드는 2개의 과정이 등록되어 있다. 각각 파일이 하나씩 생성이 되는데 main 폴더의 파일은 test1.js파일을 중심으로 합쳐지고 worker 폴더의 파일들은 test2.js를 중심으로 합쳐지는 것 같습니다. 합쳐지느 파일은 각각 dist 폴더의 main-bundle.js와 worker-bundle.js 파일로 출력이 됩니다.

* git과의 연동

webpack의 역할은 개발자를 매우 편리하게 해주지만 bundler 파일은 브라우저에 전달하기만 하면 되지 git에 올라갈 필요는 없겠죠. 그러니 git에 따로 저장하지 않도록 .gitignore 을 사용합니다.  

dist/
.idea/
*.iml

이렇게 작성을 한다면 dist 폴더에 있는 것들이 git에 저장되지 않습니다.
