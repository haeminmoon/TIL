# Closure

- 클로저는 자신이 생성될 때의 환경을 기억하는 함수다.
 : 클로저는 자신이 생성될 때의 스코프에서 알 수 있었던 변수를 기억하는 함수다.
  : 클로저는 자신이 생성되는 스코프의 실행 컨텍스트에서 만들어졌거나 알 수 있었던 변수 중 언 젠가 자신이 실행될 때 사용할 변수들만 기억하는 함수이다. 클로저가 기억하는 변수의 값은 언 제든지 남이나 자신에 의해 변경될 수 있다.

 ex1)
   function f2() {
    var a = 10;
    var b = 20;
    function f3(c, d) {
      return c + d;
    }
    return f3;
  }
  var f4 = f2();
  f4(5, 7);
  // 12

클로저가 아니다.

 ex2)
   function f4() {
     var a = 10;
     var b = 20;
     function f5() {
       return a + b;
     }
     return f5();
   }
   f4();
   // 30

 f5는 클로저 였었다. 결과적으로는 클로저는 없다라고 볼 수 있다.

 f4가 실행되고 a, b가 할당된 후 f5가 정의된다. 그리고 f5에서는 a, b가 사용되고 있으므로 f5는 자신이 생성된 환경을 기억하는 클로저가 된다. 그런데 f4의 마지막 라인을 보면 f5를 실행하여 리턴한다. 결국 f5를 참조하고 있는 곳이 어디에도 없기 때문에 f5는 사라지게 되고 f5가 사라지면 a, b도 사라질 수 있기에 클로저는 f4가 실행되는 사이에만 생겼다가 사라진다.

 혹시 그동안 내부에 함수를 정의하여 외부 변수를 참조하는 것만으로 클로저가 될 것 같아 함수 내부에서 함수를 정의하는 것을 꺼렸다면, 그것만으로는 클로저가 되지 않으니 마음껏 사용해도 된다. 이런 부분들을 잘 숙지해 두면 더욱 편하게 프로그래밍을 할 수 있다.

 ex3)
   function f6() {
    var a = 10;
    function f7(b) {
      return a + b;
    }
    return f7;
  }
  var f8 = f6();
  f8(20);
  // 30
  f8(10);
  // 20

 f7은 진짜 클로저다. 이제 a는 사라지지 않는다. f7이 a를 사용하기에 a를 기억해야하고 f7이 f8에 담겼기 때문에 클로저가 되었다. 원래대로라면 f6의 지역 변수는 모두 사라져야 하지만 f6 실행이 끝났어도 f7이 a를 기억하는 클로저가 되었기 때문에 a는 사라지지 않으며, f8을 실행할 때마다 새로운 변수인 b 함께 사용되어 결과를 만든다. (여기서도 만약 f6의 실행 결과인 f7을 f8에 담지 않았다면 f7은 클로저가 되지 않는다.)

 ex4)
   function f9() {
     var a = 10;
     var f10 = function(c) {
       return a + b + c;
     };
     var b = 20;
     return f10;
   }
   var f11 = f9();
   f11(30);
   // 60

 위 예제의 결과는 어떻게 나올까? 혹시 에러가 날까? f11(30)의 실행 결과는 60이다. 10 + 20 + 30이 되어 60이 나온다. 클로저는 자신이 생성될 '때'의 스코프에서 알 수 있었던 변수를 기억하는 함수라고 했었는데 여기서 '때'는 생각하는 것보다 조금 길다고 했었다. 이 예제는 그것을 보여주는 예제다. 그리고 "스코프에서 알 수 있었던"이라고 했었는데 그것의 일부도 이 예제에서 설명된다.

 f10에는 익명 함수를 담았다. (f10의 정의를 function f10(c) { ... }로 해도 위 예제는 정상 동작한다.) 해당 예제에서 f10이 생성되기 딱 이전 시점에는 b가 20으로 초기화되지 않았다. 클로저는 자신이 생성되는 스코프의 모든 라인, 어느 곳에서 선언된 변수든지 참조하고 기억할 수 있다. 그리고 그것은 변수이기에 클 로저가 생성된 이후 언제라도 그 값은 변경될 수 있다.

[클로저 참고 링크](https://github.com/indongyoo/functional-javascript/wiki/1.4-%ED%95%A8%EC%88%98%ED%98%95-%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EB%A5%BC-%EC%9C%84%ED%95%9C-%EA%B8%B0%EC%B4%88)
